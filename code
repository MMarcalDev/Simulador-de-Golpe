<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Simulador de Golpes — Versão Acessível</title>
<style>
  :root{
    --bg:#f2efe9;
    --panel:#ffffff;
    --muted:#6b6b6b;
    --text:#111;
    --accent:#075E54; /* verde estilo WhatsApp */
    --danger:#c62828;
    --good:#2e7d32;
    --bubble-radius:20px;
    --gap:18px;
    --large-font:18px;
    --btn-height:56px;
    --high-contrast-text: #ffffff;
    --shadow: 0 10px 30px rgba(0,0,0,0.12);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,var(--bg),#ece8e2);
    color:var(--text);
    display:flex;
    align-items:stretch;
    justify-content:center;
    padding:12px;
    gap:var(--gap);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    font-size:var(--large-font);
    line-height:1.4;
    min-height:100vh;
  }

  .app {
    width:100%;
    max-width:1080px;
    display:flex;
    gap:var(--gap);
    border-radius:14px;
    overflow:hidden;
    background:transparent;
  }

 
  .side {
    width:340px;
    min-width:260px;
    background:linear-gradient(180deg,#075E54 0%, #128C7E 100%);
    color:white;
    padding:22px;
    display:flex;
    flex-direction:column;
    gap:12px;
    box-shadow:var(--shadow);
    border-radius:12px;
  }
  .side h2{margin:0;font-size:20px}
  .side p{margin:0;color:rgba(255,255,255,0.95);font-size:15px}
  .side .meta{margin-top:auto;font-size:13px;opacity:0.95}
  .toggle-side {
    display:none;
    background:transparent;
    border:2px solid rgba(255,255,255,0.14);
    color:white;
    padding:10px 12px;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
  }


  .main {
    flex:1;
    background:var(--panel);
    border-radius:12px;
    padding:18px;
    display:flex;
    flex-direction:column;
    gap:12px;
    box-shadow:var(--shadow);
    min-height:520px;
  }

  .header {
    display:flex;
    gap:12px;
    align-items:center;
  }
  .brand {
    width:56px;height:56px;border-radius:10px;
    background:linear-gradient(45deg,#075E54,#128C7E);
    display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:20px;
    flex-shrink:0;
  }
  .title { font-weight:800; font-size:20px; }
  .subtitle { font-size:15px; color:var(--muted) }

  .progress {
    margin-left:auto;
    font-weight:700;
    background:#f3f3f3;
    padding:8px 12px;
    border-radius:10px;
    font-size:14px;
  }

 
  .chat-frame {
    background:linear-gradient(#fbfbfb,#f7f7f7);
    border-radius:12px;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:12px;
    min-height:380px;
    max-height:56vh;
    overflow:auto;
    border:1px solid rgba(0,0,0,0.04);
  }

  .msg-row { display:flex; gap:12px; align-items:flex-end; }
  .msg-row.right { justify-content:flex-end; flex-direction:row-reverse; }
  .avatar {
    width:48px; height:48px; border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;flex-shrink:0;font-size:16px;
    box-shadow:0 6px 16px rgba(0,0,0,0.08);
  }

  .bubble {
    max-width:78%;
    padding:14px 16px;
    border-radius:var(--bubble-radius);
    font-size:16px;
    line-height:1.45;
    position:relative;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    opacity:0; transform: translateY(12px) scale(0.995);
    will-change: transform, opacity;
    transition: transform 360ms cubic-bezier(.22,.9,.2,1), opacity 320ms ease;
  }
  .bubble.enter { opacity:1; transform: translateY(0) scale(1); }

  .whatsapp { background:linear-gradient(#dcf8c6,#dcf8c6); border:1px solid rgba(0,0,0,0.03); }
  .sms { background:#ffffff; border:1px solid #ececec; }
  .email { background:linear-gradient(180deg,#ffffff,#fcfcff); border:1px solid #eef; }

  .email-header { font-weight:800; font-size:14px; margin-bottom:8px; color:var(--muted) }

  .bubble .meta { font-size:13px; color:var(--muted); margin-top:8px }


  .controls {
    display:flex;
    gap:12px;
    align-items:center;
    padding-top:6px;
  }

  .btn {
    min-height:var(--btn-height);
    padding:6px 12px;
    border-radius:10px;
    border:none;
    font-weight:800;
    cursor:pointer;
    font-size:18px;
    box-shadow:0 10px 24px rgba(0,0,0,0.08);
    transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
  }
  .btn:active{ transform: translateY(2px) scale(0.996); box-shadow:0 6px 16px rgba(0,0,0,0.12) }
  .btn[disabled]{ opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none; }

  .btn-golpe { background:var(--danger); color:var(--high-contrast-text); }
  .btn-seguro { background:var(--good); color:var(--high-contrast-text); }
  .btn-next { background:#0b74da; color:var(--high-contrast-text); }
  .btn-restart { background:#333; color:var(--high-contrast-text); }

  .controls .spacer { flex:1 }


  .feedback {
    display:none;
    padding:14px;
    border-radius:10px;
    background:#fff;
    border-left:8px solid var(--accent);
    font-size:16px;
    box-shadow:0 10px 30px rgba(0,0,0,0.06);
    opacity:0;
    transform: translateY(8px);
  }
  .feedback.show {
    display:block;
    animation: fadeInUp 360ms ease forwards;
  }

  .result {
    margin-top:6px;
    padding:14px;
    background:#fff;
    border-radius:10px;
    display:none;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.06);
  }

  .type-wh { background:linear-gradient(45deg,var(--accent),#128C7E); border-radius:8px; padding:6px 8px; color:white; font-weight:800; font-size:13px; display:inline-block; }
  .type-sms { background:#1976D2; color:white; padding:6px 8px; border-radius:8px; font-size:13px; display:inline-block; }
  .type-email { background:#7b68ee; color:white; padding:6px 8px; border-radius:8px; font-size:13px; display:inline-block; }


  /* small screens: stack and keep aside visible (user requested) */
  @media (max-width:900px){
    .app { flex-direction:column; max-width:720px; }
    .side {
      width:100%;
      order:1;
      border-radius:12px;
      padding:14px;
      display:flex;
    }
    .toggle-side { display:inline-flex; margin-left:auto; }
  }

  /* very small screens: make aside collapsible but present by default; show toggle to hide */
  @media (max-width:520px){
    .side { padding:12px; }
    .chat-frame { max-height:48vh; min-height:300px; }
    .brand{width:48px;height:48px}
    .avatar{width:44px;height:44px}
    .btn { font-size:17px; min-height:52px }
  }

  @keyframes fadeInUp {
    0% { opacity:0; transform:translateY(8px) }
    100% { opacity:1; transform:translateY(0) }
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Simulador de Golpes Digitais — Acessível">
    <aside class="side" id="sidePanel" aria-label="Informações do simulador">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="flex:1">
          <h2>Simulador de Golpes</h2>
          <p>Treine a identificação de mensagens falsas (WhatsApp, SMS e E-mail). Cada sessão mostra 5 mensagens aleatórias. Leia a explicação e só avance quando estiver pronto.</p>
        </div>
        <button id="toggleSide" class="toggle-side" aria-expanded="true" aria-controls="sidePanel">Ocultar</button>
      </div>
      <p class="meta">Criado por Matheus Porto Marçal<br>Projeto de Extensão ADS</p>
    </aside>

    <main class="main">
      <header class="header" aria-hidden="false">
        <div style="display:flex;gap:12px;align-items:center;flex:1">
          <div class="brand" aria-hidden="true"> </div>
          <div>
            <div class="title">Simulador de Golpes</div>
            <div class="subtitle">Classifique cada mensagem como <strong>Golpe</strong> ou <strong>Seguro</strong></div>
          </div>
        </div>
        <div class="progress" id="progress" aria-live="polite" aria-atomic="true">0/5</div>
      </header>

      <section id="chat" class="chat-frame" role="region" aria-live="polite" aria-atomic="true">
        <!-- mensagens injetadas -->
      </section>

      <div class="controls" id="controls" role="toolbar" aria-label="Controles de resposta">
        <button id="btnGolpe" class="btn btn-golpe" aria-pressed="false" aria-label="Marcar como golpe (tecla G)">GOLPE</button>
        <button id="btnSeguro" class="btn btn-seguro" aria-pressed="false" aria-label="Marcar como seguro (tecla S)">SEGURO</button>

        <div class="spacer" aria-hidden="true"></div>

        <button id="btnNext" class="btn btn-next" aria-label="Próxima mensagem (tecla N)" style="display:none">PRÓXIMO</button>
      </div>

      <div id="feedback" class="feedback" role="status" aria-live="polite"></div>

      <div id="result" class="result" role="region" aria-label="Resultado final" style="display:none">
        <div id="scoreText" style="font-weight:800;font-size:18px"></div>
        <div style="display:flex;gap:12px;align-items:center">
          <button id="btnRestart" class="btn btn-restart" aria-label="Reiniciar teste (tecla R)">REINICIAR</button>
        </div>
      </div>
    </main>
  </div>

<script>

const mensagens = [
  // === WhatsApp
  { canal:"whatsapp", texto:"Parabéns! Você ganhou um cupom de R$ 1000! Responda 'SIM' para receber.", tipo:"Golpe", explicacao:"Promoções milagrosas normalmente são tentativas de coletar dados pessoais ou levar você a clicar em links maliciosos.", remetente:"Promo Super", avatarColor:"#FF7043" },
  { canal:"whatsapp", texto:"Olá, sou seu neto. Troquei de número. Preciso de dinheiro, por favor, me envie o PIX.", tipo:"Golpe", explicacao:"Falsos parentes pedem transferências; confirme sempre por outro canal (ligação).", remetente:"Lucas", avatarColor:"#8E24AA" },
  { canal:"whatsapp", texto:"Você foi sorteado! Clique no link e ganhe um celular grátis.", tipo:"Golpe", explicacao:"Sorteios inesperados são isca para instalar malware ou roubar dados.", remetente:"Sorteios BR", avatarColor:"#5D4037" },
  { canal:"whatsapp", texto:"URGENTE: Seu banco bloqueou sua conta. Clique para desbloquear.", tipo:"Golpe", explicacao:"Bancos não pedem dados por links. Procure o banco por telefone oficial.", remetente:"Banco Info", avatarColor:"#1976D2" },
  { canal:"whatsapp", texto:"Seu cadastro na promoção foi confirmado. Envie CPF e senha para validar.", tipo:"Golpe", explicacao:"Nunca passe senhas ou dados bancários por mensagem.", remetente:"Promoção", avatarColor:"#388E3C" },
  { canal:"whatsapp", texto:"Recebemos uma devolução por engano. Reembolse enviando o comprovante.", tipo:"Golpe", explicacao:"Golpistas pedem reembolso de valores inexistentes; verifique extrato oficial.", remetente:"Entrega", avatarColor:"#FF5722" },
  { canal:"whatsapp", texto:"Seu número foi escolhido para teste do novo app. Instale pelo link.", tipo:"Golpe", explicacao:"Links para instalar apps podem conter malware.", remetente:"AppTest", avatarColor:"#6A1B9A" },
  { canal:"whatsapp", texto:"Atualizamos o WhatsApp, clique para manter suas conversas.", tipo:"Golpe", explicacao:"Atualizações oficiais vêm pela loja de apps, não por link via mensagem.", remetente:"WhatsApp", avatarColor:"#388E3C" },
  { canal:"whatsapp", texto:"Sou do suporte do banco, qual é sua agência para confirmar uma operação?", tipo:"Golpe", explicacao:"Banco não solicita dados por chat; ligue no número oficial do banco.", remetente:"Suporte Banco", avatarColor:"#1E88E5" },
  { canal:"whatsapp", texto:"Envie 6 dígitos que eu te explico como resgatar o prêmio.", tipo:"Golpe", explicacao:"Códigos de verificação podem dar acesso a sua conta — nunca compartilhe.", remetente:"Prêmios", avatarColor:"#00897B" },
  { canal:"whatsapp", texto:"Seu benefício social foi aprovado; clique aqui para agendar retirada.", tipo:"Golpe", explicacao:"Ofertas de benefícios e agendamento via link podem ser fraudulentas.", remetente:"Benefício", avatarColor:"#D81B60" },
  { canal:"whatsapp", texto:"Atualize seus dados do cadastro escolar pelo link para não perder matrícula.", tipo:"Golpe", explicacao:"Instituições não pedem atualização de dados sensíveis por link sem aviso oficial.", remetente:"Escola", avatarColor:"#3F51B5" },
  { canal:"whatsapp", texto:"Preciso urgente de R$ 2.000, sou eu, filho, não conte para ninguém.", tipo:"Golpe", explicacao:"Pressão emocional é técnica comum — confirme por chamada de voz.", remetente:"Filho", avatarColor:"#7B1FA2" },
  { canal:"whatsapp", texto:"Seu boleto foi emitido com erro. Clique para pagar e evitar multa.", tipo:"Golpe", explicacao:"Boleto falso pode redirecionar pagamento; confira no site oficial da empresa.", remetente:"Cobrança", avatarColor:"#E64A19" },
  { canal:"whatsapp", texto:"Estamos cobrando uma taxa de entrega urgente, pague para liberar encomenda.", tipo:"Golpe", explicacao:"Correios/transportadoras não cobram taxas por mensagem com link.", remetente:"Transportadora", avatarColor:"#546E7A" },
  { canal:"whatsapp", texto:"Oferta exclusiva para clientes: insira seus dados e garanta desconto.", tipo:"Golpe", explicacao:"Formulários que pedem muitos dados pessoais via link são suspeitos.", remetente:"Descontos", avatarColor:"#2E7D32" },
  { canal:"whatsapp", texto:"Você recebeu um vídeo — abra para ver a surpresa!", tipo:"Golpe", explicacao:"Vídeos ou arquivos desconhecidos podem conter links maliciosos; não abra.", remetente:"Contato", avatarColor:"#0277BD" },
  { canal:"whatsapp", texto:"Confirmamos pagamento de R$ 500, reenvie o comprovante para ajustar.", tipo:"Golpe", explicacao:"Mensagens que solicitam comprovante para devolver dinheiro são técnicas de engano.", remetente:"Vendedor", avatarColor:"#C2185B" },
  { canal:"whatsapp", texto:"Seu cadastro foi atualizado, envie CPF e senha para finalizar.", tipo:"Golpe", explicacao:"Nunca informe senha por mensagem; instituições não pedem senha completa.", remetente:"Cadastro", avatarColor:"#00838F" },
  { canal:"whatsapp", texto:"Participe do sorteio respondendo 'SIM' — são 10 prêmios!", tipo:"Golpe", explicacao:"Respostas em massa servem para validar números para golpes futuros.", remetente:"Sorteio", avatarColor:"#F4511E" },

  // === SMS 
  { canal:"sms", texto:"[URGENTE] Conta bancária suspensa. Acesse: http://falso.link para regularizar.", tipo:"Golpe", explicacao:"Links em SMS pedindo regularização costumam ser falsos; acesse apenas canais oficiais.", remetente:"Banco", avatarColor:"#3E2723" },
  { canal:"sms", texto:"Ganhou um prêmio! Responda SIM para receber instruções.", tipo:"Golpe", explicacao:"SMS promocional inesperado é frequentemente isca para golpe.", remetente:"Promo SMS", avatarColor:"#283593" },
  { canal:"sms", texto:"Pedido não entregue. Clique para reagendar e confirme seus dados.", tipo:"Golpe", explicacao:"Transportadoras não pedem dados por links desconhecidos via SMS.", remetente:"Entrega", avatarColor:"#FF6F00" },
  { canal:"sms", texto:"Seu plano de saúde exige atualização. Envie seus documentos por link.", tipo:"Golpe", explicacao:"Empresas sérias não solicitam documentos sensíveis via links SMS.", remetente:"Saúde", avatarColor:"#0D47A1" },
  { canal:"sms", texto:"Erro na fatura: reenvie dados para evitar suspensão.", tipo:"Golpe", explicacao:"Operadoras não pedem dados desta forma; consulte a fatura oficial.", remetente:"Operadora", avatarColor:"#00695C" },
  { canal:"sms", texto:"PIX recebido por engano. Reenvie comprovante para devolução.", tipo:"Golpe", explicacao:"Confirme no extrato do seu banco; não confie apenas em mensagem.", remetente:"PIX", avatarColor:"#B71C1C" },
  { canal:"sms", texto:"Oferta exclusiva: 70% OFF em eletrodomésticos. Acesse já.", tipo:"Golpe", explicacao:"Descontos exagerados são isca para cliques em links maliciosos.", remetente:"Lojas", avatarColor:"#1E88E5" },
  { canal:"sms", texto:"Você tem voicemails não escutados. Clique para ouvir.", tipo:"Golpe", explicacao:"Links para ouvir mensagens podem instalar apps maliciosos.", remetente:"Operadora Voz", avatarColor:"#283593" },
  { canal:"sms", texto:"Confirme seu CPF para resgatar benefício social.", tipo:"Golpe", explicacao:"Governo não solicita CPF por SMS para resgate de benefícios sem processo oficial.", remetente:"Governo", avatarColor:"#2E7D32" },
  { canal:"sms", texto:"Sua assinatura será cancelada, clique para manter o serviço.", tipo:"Golpe", explicacao:"Empresas avisam por canais oficiais, não por links em SMS duvidosos.", remetente:"Serviço", avatarColor:"#4E342E" },
  { canal:"sms", texto:"Envie seu número do cartão para confirmar compra.", tipo:"Golpe", explicacao:"Nunca passe dados do cartão por SMS.", remetente:"Compras", avatarColor:"#AD1457" },
  { canal:"sms", texto:"Comprovante de pagamento disponível, baixe aqui.", tipo:"Golpe", explicacao:"Baixar comprovantes de fontes desconhecidas é perigoso.", remetente:"Financeiro", avatarColor:"#0277BD" },
  { canal:"sms", texto:"Seu seguro foi aprovado. Clique para agendar vistoria.", tipo:"Golpe", explicacao:"Agendamentos com link em SMS podem pedir dados sensíveis; confirme por telefone.", remetente:"Seguro", avatarColor:"#2E7D32" },
  { canal:"sms", texto:"Atualize seu cadastro para receber cupom de desconto.", tipo:"Golpe", explicacao:"Formulários para 'atualizar cadastro' via link podem roubar informações.", remetente:"Cadastro", avatarColor:"#6D4C41" },
  { canal:"sms", texto:"Seu pagamento falhou. Pague agora clicando no link.", tipo:"Golpe", explicacao:"Verifique no aplicativo oficial do serviço antes de pagar.", remetente:"Vendas", avatarColor:"#00695C" },
  { canal:"sms", texto:"Foi detectada atividade suspeita na sua conta. Acesse para confirmar.", tipo:"Golpe", explicacao:"Sites falsos imitam alertas para roubar credenciais.", remetente:"Segurança", avatarColor:"#1B5E20" },
  { canal:"sms", texto:"Recebemos sua inscrição. Envie comprovante pelo link.", tipo:"Golpe", explicacao:"Links solicitando comprovantes podem ser armadilhas.", remetente:"Organização", avatarColor:"#4527A0" },
  { canal:"sms", texto:"Seu cupom expira hoje! Clique para resgatar agora.", tipo:"Golpe", explicacao:"Pressão por tempo é técnica para induzir cliques impulsivos.", remetente:"Promoções", avatarColor:"#BF360C" },
  { canal:"sms", texto:"Valide seu cadastro no aplicativo com este código: 123456.", tipo:"Golpe", explicacao:"Códigos de verificação devem ser mantidos em sigilo; não repasse.", remetente:"App", avatarColor:"#37474F" },
  { canal:"sms", texto:"Atualização de segurança necessária. Instale pelo link.", tipo:"Golpe", explicacao:"Atualizações oficiais vêm da loja; não instale via SMS.", remetente:"Segurança App", avatarColor:"#D84315" },

  // === E-mail 
  { canal:"email", texto:"Assunto: Notificação de Cobrança\n\nPrezado(a), seu boleto está em atraso. Baixe o anexo para pagar.", tipo:"Golpe", explicacao:"Anexos e links em e-mails não solicitados podem conter malware.", remetente:"Financeiro Corp", subject:"Notificação de Cobrança" , avatarColor:"#455A64"},
  { canal:"email", texto:"Assunto: Confirmação de Pedido\n\nClique no link para confirmar seu pedido.", tipo:"Golpe", explicacao:"Links em e-mail devem ser verificados; passe o mouse no link ou vá ao site oficial.", remetente:"Loja Online", subject:"Confirmar Pedido", avatarColor:"#6A1B9A"},
  { canal:"email", texto:"Assunto: Atualização de Segurança\n\nAtualize sua conta clicando aqui.", tipo:"Golpe", explicacao:"E-mails falsos que pedem atualização de login são phishing.", remetente:"Banco Digital", subject:"Atualização de Segurança", avatarColor:"#0D47A1"},
  { canal:"email", texto:"Assunto: Você foi sorteado!\n\nResponda este e-mail para receber instruções.", tipo:"Golpe", explicacao:"Sorteios por e-mail sem antecedência são suspeitos.", remetente:"Sorteios Ltda", subject:"Você Ganhou!", avatarColor:"#D32F2F"},
  { canal:"email", texto:"Assunto: Entrega Pendente\n\nSeu pacote está aguardando pagamento da taxa. Pague aqui.", tipo:"Golpe", explicacao:"Transportadoras oficiais não cobram taxas via e-mail com link.", remetente:"Transportes", subject:"Entrega Pendente", avatarColor:"#2E7D32"},
  { canal:"email", texto:"Assunto: Verifique sua conta\n\nClique para validar suas informações.", tipo:"Golpe", explicacao:"E-mails pedindo validação de dados costumam ser falsos.", remetente:"Serviço Online", subject:"Validação de Conta", avatarColor:"#283593"},
  { canal:"email", texto:"Assunto: Atualize seu login\n\nSeu acesso expirou, atualize aqui.", tipo:"Golpe", explicacao:"Sites falsos imitam páginas de login; abra apenas pelo site oficial.", remetente:"Plataforma", subject:"Ação Necessária", avatarColor:"#1976D2"},
  { canal:"email", texto:"Assunto: Multiplique seus ganhos\n\nInvista aqui e garanta retorno rápido.", tipo:"Golpe", explicacao:"Promessas de lucro rápido são geralmente golpes financeiros.", remetente:"Invest BR", subject:"Oportunidade de Investimento", avatarColor:"#00695C"},
  { canal:"email", texto:"Assunto: Falha no pagamento\n\nClique para regularizar seu boleto.", tipo:"Golpe", explicacao:"Confirme sempre junto ao emissor do documento.", remetente:"Cobrança", subject:"Falha no Pagamento", avatarColor:"#EF6C00"},
  { canal:"email", texto:"Assunto: Reembolso Aprovado\n\nEnvie seus dados bancários para receber.", tipo:"Golpe", explicacao:"Nunca envie dados bancários por e-mail para receber reembolso.", remetente:"Financeiro", subject:"Reembolso", avatarColor:"#C2185B"},
  { canal:"email", texto:"Assunto: Confirmação de Agendamento\n\nClique aqui para confirmar a visita técnica.", tipo:"Golpe", explicacao:"Prefira confirmar por telefone oficial ao invés de links desconhecidos.", remetente:"Assistência", subject:"Confirmação Agendamento", avatarColor:"#0288D1"},
  { canal:"email", texto:"Assunto: Pesquisa Premiada\n\nParticipe e concorra a prêmios!", tipo:"Golpe", explicacao:"Pesquisas premiadas por e-mail costumam pedir dados sensíveis.", remetente:"Instituto", subject:"Participe e Ganhe", avatarColor:"#512DA8"},
  { canal:"email", texto:"Assunto: Atualização do Cliente\n\nAbra o anexo para atualizar o software.", tipo:"Golpe", explicacao:"Anexos .exe/.zip são perigosos; prefira sites oficiais.", remetente:"Suporte", subject:"Atualização Cliente", avatarColor:"#283593"},
  { canal:"email", texto:"Assunto: Confirmação de Doação\n\nPrecisamos que confirme seus dados.", tipo:"Golpe", explicacao:"Organizações sérias não pedem dados sensíveis por e-mail sem contato prévio.", remetente:"ONG", subject:"Confirmar Doação", avatarColor:"#2E7D32"},
  { canal:"email", texto:"Assunto: Recuperação de Senha\n\nClique aqui para redefinir sua senha.", tipo:"Golpe", explicacao:"Links para redefinição devem ser usados apenas quando você mesmo solicitou.", remetente:"Portal", subject:"Recuperação de Senha", avatarColor:"#1E88E5"},
  { canal:"email", texto:"Assunto: Fatura em Anexo\n\nBaixe o arquivo para verificar.", tipo:"Golpe", explicacao:"Anexos imprevistos podem conter malware; verifique com a empresa.", remetente:"Prestadora", subject:"Fatura", avatarColor:"#37474F"},
  { canal:"email", texto:"Assunto: Atualização cadastral\n\nResponda com CPF e RG para manter benefícios.", tipo:"Golpe", explicacao:"Não forneça documentos sem confirmar identidade do solicitante.", remetente:"Benefícios", subject:"Atualização Cadastral", avatarColor:"#C62828"},
  { canal:"email", texto:"Assunto: Informações fiscais\n\nEnvie seus comprovantes por este link.", tipo:"Golpe", explicacao:"Autoridades fiscais não pedem documentos dessa forma.", remetente:"Fiscal", subject:"Informações Fiscais", avatarColor:"#455A64"},
  { canal:"email", texto:"Assunto: Prêmio Inesperado\n\nVocê ganhou $1000. Envie dados para receber.", tipo:"Golpe", explicacao:"Prêmios inesperados pedem dados e são geralmente golpes.", remetente:"Prêmios", subject:"Parabéns!", avatarColor:"#8E24AA"},
  { canal:"email", texto:"Assunto: Suporte Técnico\n\nNos envie acesso remoto para resolver o problema.", tipo:"Golpe", explicacao:"Não permita acesso remoto a desconhecidos; empresas não solicitam por e-mail sem protocolo.", remetente:"Suporte Remoto", subject:"Suporte Técnico", avatarColor:"#0277BD" },

  // === Mensagens seguras
  { canal:"whatsapp", texto:"Bom dia! Você tem compromisso amanhã às 10h com Dr. João. Confirma?", tipo:"Seguro", explicacao:"Mensagem pessoal simples sem solicitação de dados sensíveis.", remetente:"Clínica Santa", avatarColor:"#00796B" },
  { canal:"whatsapp", texto:"Oi tia, aqui é a Ana. Vou passar aí às 14h para a visita.", tipo:"Seguro", explicacao:"Mensagem típica de um contato conhecido sem pedido de dinheiro.", remetente:"Ana", avatarColor:"#5D4037" },
  { canal:"sms", texto:"Seu código de confirmação para acesso ao portal é 482915. Não compartilhe com ninguém.", tipo:"Seguro", explicacao:"SMS com código de verificação legítimo deve ser guardado, não compartilhado.", remetente:"Portal", avatarColor:"#455A64" },
  { canal:"sms", texto:"Confirmação: agendamento realizado para 20/08 às 9h.", tipo:"Seguro", explicacao:"SMS de confirmação de serviço é comum e seguro se você reconhece a operação.", remetente:"Serviço", avatarColor:"#0288D1" },
  { canal:"email", texto:"Assunto: Comprovante de inscrição\n\nSua inscrição foi realizada com sucesso. Anexo: comprovante.pdf", tipo:"Seguro", explicacao:"E-mail com comprovante de inscrição esperado e proveniente de fonte conhecida.", remetente:"Eventos", subject:"Comprovante de inscrição", avatarColor:"#2E7D32" },
  { canal:"email", texto:"Assunto: Recibo de pagamento\n\nSegue recibo do pagamento efetuado. Sem necessidade de ação.", tipo:"Seguro", explicacao:"E-mail financeiro legítimo costuma vir após transação reconhecida.", remetente:"Loja X", subject:"Recibo de pagamento", avatarColor:"#1976D2" },
  { canal:"whatsapp", texto:"Olá, sou voluntário da igreja. Posso ajudar com compras nesta semana?", tipo:"Seguro", explicacao:"Mensagem de contato voluntário legítimo, sem pedidos suspeitos.", remetente:"Igreja Local", avatarColor:"#6A1B9A" },
  { canal:"sms", texto:"Lembrete: Vacinação dia 15/09. Levar cartão de vacinação.", tipo:"Seguro", explicacao:"SMS de lembrete de serviço público é habitual e seguro.", remetente:"Saúde", avatarColor:"#2E7D32" },
  { canal:"email", texto:"Assunto: Histórico de atendimento\n\nSegue histórico solicitado. Abra apenas se solicitou.", tipo:"Seguro", explicacao:"E-mail com documento solicitado por você é geralmente seguro.", remetente:"Clínica", subject:"Histórico", avatarColor:"#0288D1" },
  { canal:"whatsapp", texto:"Boa tarde! Aqui é o João do mercado, seus legumes estão prontos.", tipo:"Seguro", explicacao:"Mensagem comercial conhecida e esperada é provavelmente segura.", remetente:"Mercado", avatarColor:"#F57C00" },
  { canal:"sms", texto:"Código de retirada: 7593. Apresente no balcão.", tipo:"Seguro", explicacao:"SMS com código para retirada em loja é seguro se você reconhece a compra.", remetente:"Loja", avatarColor:"#795548" },
  { canal:"email", texto:"Assunto: Agendamento confirmado\n\nSeu atendimento foi confirmado para 02/09 às 11h.", tipo:"Seguro", explicacao:"Confirmações por e-mail de agendamento reconhecido são seguras.", remetente:"Serviço", subject:"Agendamento confirmado", avatarColor:"#455A64" },
  { canal:"whatsapp", texto:"Enviei fotos da receita pelo grupo, confira quando puder.", tipo:"Seguro", explicacao:"Envio de fotos por contato conhecido é normal e seguro.", remetente:"Filha", avatarColor:"#AD1457" },
  { canal:"sms", texto:"Estamos aguardando você na consulta às 16h.", tipo:"Seguro", explicacao:"Lembretes SMS conhecidos são seguros.", remetente:"Clínica", avatarColor:"#0288D1" },
  { canal:"email', texto:'Assunto: Relatório mensal\n\nSegue relatório mensal solicitado.", tipo:"Seguro", explicacao:"E-mail com arquivos solicitados por você é esperado e seguro.", remetente:"Empresa", subject:"Relatório mensal", avatarColor:"#283593" },
  { canal:"email", texto:"Assunto: Comprovante de agendamento\n\nSeu agendamento está confirmado.", tipo:"Seguro", explicacao:"Comprovantes e confirmações esperadas por e-mail são seguros.", remetente:"Atendimento", subject:"Comprovante", avatarColor:"#2E7D32" },
  { canal:"whatsapp", texto:"Amanhã recolhemos o lixo eletrônico. Obrigado por colaborar.", tipo:"Seguro", explicacao:"Mensagens comunitárias informativas são seguras.", remetente:"Coleta", avatarColor:"#00796B" },
  { canal:"sms", texto:"Seu horário para prova foi agendado: 10/10 às 9h.", tipo:"Seguro", explicacao:"SMS informativo e reconhecido é legítimo.", remetente:"Instituição", avatarColor:"#6A1B9A" },
  { canal:"whatsapp", texto:"Liguei e deixei recado. Quando puder, retorno a ligação.", tipo:"Seguro", explicacao:"Mensagem de contato simples sem pedido de dados sensíveis é segura.", remetente:"Contato", avatarColor:"#37474F" }
];


/* ------------- Configurações da sessão ------------- */
const totalQuestions = 5;
let sessionSet = [];
let index = 0;
let score = 0;

/* elementos DOM */
const chatEl = document.getElementById('chat');
const progressEl = document.getElementById('progress');
const btnGolpe = document.getElementById('btnGolpe');
const btnSeguro = document.getElementById('btnSeguro');
const btnNext = document.getElementById('btnNext');
const feedbackEl = document.getElementById('feedback');
const resultEl = document.getElementById('result');
const scoreText = document.getElementById('scoreText');
const btnRestart = document.getElementById('btnRestart');
const sidePanel = document.getElementById('sidePanel');
const toggleSide = document.getElementById('toggleSide');


const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playTone(freq=440, duration=0.12, type='sine', vol=0.08){
  try {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = vol;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    o.stop(audioCtx.currentTime + duration + 0.02);
  } catch(e){ /* se WebAudio indisponível, silencioso */ }
}

function soundReceive(){ playTone(1100,0.06,'sine',0.06); }
function soundCorrect(){ playTone(880,0.12,'sine',0.12); setTimeout(()=>playTone(1320,0.12,'sine',0.08),120); }
function soundWrong(){ playTone(220,0.22,'sine',0.14); }
function soundFinish(){ playTone(1200,0.12,'sine',0.10); setTimeout(()=>playTone(1600,0.12,'sine',0.08),160); setTimeout(()=>playTone(2000,0.12,'sine',0.06),320); }



function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }


function prepareSession(){
  index = 0; score = 0;
  feedbackEl.style.display = 'none';
  resultEl.style.display = 'none';
  chatEl.innerHTML = '';
  // garantir cópia e embaralhar
  const pool = shuffle([...mensagens]);
  sessionSet = pool.slice(0, totalQuestions);
  updateProgress();
  renderCurrentWithDelay();
}


function renderCurrentWithDelay(){
  chatEl.innerHTML = ''; // foco apenas na atual
  const m = sessionSet[index];
  btnGolpe.disabled = true; btnSeguro.disabled = true; btnNext.style.display = 'none';
  feedbackEl.style.display = 'none';
  // simular chegada
  setTimeout(()=>{
    renderMessage(m);
    soundReceive();
    setTimeout(()=>{ btnGolpe.disabled=false; btnSeguro.disabled=false; document.getElementById('btnGolpe').focus(); }, 300);
  }, 420);
}


function renderMessage(m){
  chatEl.innerHTML = '';
  const row = document.createElement('div');
  row.className = 'msg-row msg-left';

  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  avatar.style.background = m.avatarColor || '#888';
  avatar.setAttribute('aria-hidden','true');
  avatar.innerText = initials(m.remetente || '??');

  const bubble = document.createElement('div');
  bubble.className = 'bubble ' + (m.canal==='whatsapp' ? 'whatsapp' : (m.canal==='sms' ? 'sms' : 'email'));

  if(m.canal==='email'){
    const header = document.createElement('div');
    header.className='email-header';
    header.innerHTML = `<strong>${escapeHtml(m.remetente || '')}</strong> — ${escapeHtml(m.subject || '')}`;
    bubble.appendChild(header);
  } else {
    const small = document.createElement('div');
    small.style.marginBottom='8px';
    small.innerHTML = typeBadge(m.canal);
    bubble.appendChild(small);
  }

  const p = document.createElement('div');
  p.innerText = m.texto;
  p.style.fontSize = '17px';
  bubble.appendChild(p);

  const meta = document.createElement('div');
  meta.className='meta';
  meta.innerText = `${capitalize(m.canal)}`;
  bubble.appendChild(meta);

  row.appendChild(avatar);
  row.appendChild(bubble);
  chatEl.appendChild(row);


  setTimeout(()=> bubble.classList.add('enter'), 20);


  setTimeout(()=> { chatEl.scrollTop = chatEl.scrollHeight; }, 160);
}


function handleAnswer(choice){
  btnGolpe.disabled = true; btnSeguro.disabled = true;
  const m = sessionSet[index];
  const correct = (choice === m.tipo);
  if(correct){ score++; soundCorrect(); } else { soundWrong(); }

 
  feedbackEl.innerHTML = `<strong style="font-size:16px">${correct ? 'Correto!' : 'Errado!'}</strong><div style="margin-top:8px">${escapeHtml(m.explicacao || 'Explicação não disponível.')}</div>`;
  feedbackEl.style.borderLeftColor = correct ? 'var(--good)' : 'var(--danger)';
  feedbackEl.classList.remove('show');
  feedbackEl.style.display = 'block';
  requestAnimationFrame(()=> feedbackEl.classList.add('show'));
  btnNext.style.display = 'inline-flex';
  btnNext.focus();
}


btnNext.addEventListener('click', ()=>{
  index++;
  if(index < totalQuestions){
    updateProgress();
    renderCurrentWithDelay();
    btnNext.style.display = 'none';
  } else {
    updateProgress();
    showResult();
  }
});


btnRestart.addEventListener('click', ()=> prepareSession());


function showResult(){
  chatEl.innerHTML = '';
  feedbackEl.style.display = 'none';
  resultEl.style.display = 'flex';
  scoreText.innerText = `Você acertou ${score} de ${totalQuestions} mensagens`;
  soundFinish();
  btnRestart.focus();
}


function initials(name){ return (name || '??').split(' ').map(w=>w[0]).slice(0,2).join('').toUpperCase(); }
function capitalize(s){ if(!s) return ''; return s.charAt(0).toUpperCase()+s.slice(1); }
function escapeHtml(str){ if(!str) return ''; return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function updateProgress(){ progressEl.innerText = `${Math.min(index+1,totalQuestions)}/${totalQuestions}`; }
function typeBadge(canal){
  if(canal==='whatsapp') return `<span class="type-wh">WhatsApp</span>`;
  if(canal==='sms') return `<span class="type-sms">SMS</span>`;
  return `<span class="type-email">E-mail</span>`;
}


btnGolpe.addEventListener('click', ()=> handleAnswer('Golpe'));
btnSeguro.addEventListener('click', ()=> handleAnswer('Seguro'));


document.addEventListener('keydown',(e)=>{
  // ignore if foco em input (não há inputs aqui, mas mantemos a verificação)
  const tag = document.activeElement.tagName.toLowerCase();
  if(tag === 'input' || tag === 'textarea') return;
  if(e.key.toLowerCase()==='g' && !btnGolpe.disabled) btnGolpe.click();
  if(e.key.toLowerCase()==='s' && !btnSeguro.disabled) btnSeguro.click();
  if(e.key.toLowerCase()==='n' && btnNext.style.display!=='none') btnNext.click();
  if(e.key.toLowerCase()==='r' && resultEl.style.display!=='none') btnRestart.click();
});


toggleSide.addEventListener('click', ()=>{
  const expanded = toggleSide.getAttribute('aria-expanded') === 'true';
  if(expanded){
    // hide
    sidePanel.style.display = 'none';
    toggleSide.setAttribute('aria-expanded','false');
    toggleSide.innerText = 'Mostrar';
    // move focus to main
    document.querySelector('.title').focus();
  } else {
    sidePanel.style.display = 'flex';
    toggleSide.setAttribute('aria-expanded','true');
    toggleSide.innerText = 'Ocultar';
    sidePanel.scrollIntoView({behavior:'smooth'});
  }
});


(function ensureAsideVisible(){
  // if CSS media wanted to hide, this enforces display block by default:
  if(window.innerWidth <= 520){
    sidePanel.style.display = 'flex';
    toggleSide.setAttribute('aria-expanded','true');
    toggleSide.innerText = 'Ocultar';
  }
})();


window.addEventListener('load', ()=> {
  setTimeout(()=> document.getElementById('btnGolpe').focus(), 300);
});


prepareSession();

</script>
</body>
</html>
